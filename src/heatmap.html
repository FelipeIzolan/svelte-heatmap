<div>
    <h1>svelte-heatmap</h1>
    {{#each normalizedHistory as date}}
        <pre>{{ JSON.stringify(date) }}</pre>
    {{/each}}
</div>

<script>
    import { warn } from './utils/log';
    import { normalize } from './utils/history';

    export default {
        oncreate () {
            try {
                this.validateHistory()
            } catch (err) {
                warn(err);
            }
        },
        computed: {
            normalizedHistory: history => normalize(history || []),
        },
        methods: {
            validateHistory() {
                const history = this.get('history');

                // make sure history is present
                if (typeof history === 'undefined') {
                    throw 'Missing required "history" prop.';
                }

                // make sure the history is an array
                if (!Array.isArray(history)) {
                    throw 'History must be an array.';
                }

                // make sure each item in the history is valid
                for (let item of history) {

                    // items must be objects
                    if (typeof item !== 'object' || Array.isArray(item)) {
                        throw 'All history items must be objects with "date" and "value" properties.';
                    }

                    // items must have valid dates
                    if (typeof item.date !== 'string' || !item.date.match(/^\d{4}\/\d{2}\/\d{2}$/)) {
                        throw `Invalid history date. Expected YYYY/MM/DD string, got ${item.date}.`;
                    }

                    // items must have a valid value
                    if (typeof item.value !== 'number' || item.value < 0 || item.value === Infinity) {
                        throw `Invalid history value. Expected positive number, got ${item.value}.`
                    }
                }
            }
        }
    }
</script>
